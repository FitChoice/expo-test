# Fitchoice Mobile App

–ú–æ–±–∏–ª—å–Ω–æ–µ —Ñ–∏—Ç–Ω–µ—Å‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ **Expo + React Native**: —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–æ–∑—ã, –¥–Ω–µ–≤–Ω–∏–∫, —á–∞—Ç —Å –ò–ò‚Äë—Ç—Ä–µ–Ω–µ—Ä–æ–º, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Ñ–æ—Ç–æ‚Äë–ø—Ä–æ–≥—Ä–µ—Å—Å. –†–æ—É—Ç–∏–Ω–≥ ‚Äî **Expo Router**, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî **Feature‚ÄëSliced Design**.

## üì¶ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
pnpm install          # –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pnpm start            # dev-—Å–µ—Ä–≤–µ—Ä Metro
pnpm android          # —Å–±–æ—Ä–∫–∞/–∑–∞–ø—É—Å–∫ –¥–ª—è Android
pnpm ios              # —Å–±–æ—Ä–∫–∞/–∑–∞–ø—É—Å–∫ –¥–ª—è iOS
pnpm web              # web

pnpm run check        # format + lint (+warn‚â§10) + type-check
make start | make check | make clean | make doctor
```

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: `pnpm 10.19.0`, Expo SDK 54, Node 18+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è LTS).

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ä–æ—É—Ç–∏–Ω–≥

- –°–ª–æ–∏ FSD: `app/` (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã, –º–∞—Ä—à—Ä—É—Ç—ã), `pages/` (–∫–æ–º–ø–æ–∑–∏—Ü–∏—è), `widgets/` (—Å–æ—Å—Ç–∞–≤–Ω—ã–µ –±–ª–æ–∫–∏), `features/` (–±–∏–∑–Ω–µ—Å‚Äë—Ñ–ª–æ—É), `entities/` (–¥–∞–Ω–Ω—ã–µ/–¥–æ–º–µ–Ω—ã), `shared/` (UI kit, lib, api, constants).
- –ê–ª–∏–∞—Å –ø—É—Ç–µ–π: `@/*`.
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (`app/_layout.tsx`): ErrorBoundary ‚Üí SafeAreaProvider ‚Üí FontLoader ‚Üí TanStack Query (`staleTime` 5 –º–∏–Ω, `gcTime` 10 –º–∏–Ω, toast –Ω–∞ –æ—à–∏–±–∫–∞—Ö).
- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–æ—É—Ç—ã Expo Router: `landing`, `auth`, `register`, `forgot-password`, `verification`, `survey`, `home`, `chat`, `diary`, `stats`, `stats-day`, `photo-progress`, `profile`, `settings`, `change-password`, `privacy-policy`, `terms`, `(training)/[trainingId|session|report]` –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ `*_count` —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

## üìö –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è           | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è                                      |
| ------------------- | ----------------------------------------------- |
| Core                | React Native 0.81.5, React 19.1.0               |
| Framework           | Expo SDK 54, Expo Router 6                      |
| –Ø–∑—ã–∫                | TypeScript 5.9                                  |
| –°—Ç–∏–ª–∏               | NativeWind 4 (Tailwind –¥–ª—è RN), Rimma Sans      |
| Server State        | TanStack Query 5 (QueryProvider —Å –ø—Ä–µ–¥–Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π) |
| Client State        | Zustand 5 (—Ç–æ—á–µ—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)              |
| CV / Pose           | TensorFlow.js + MoveNet, poseflow-js, MediaPipe |
| Media               | expo-camera, expo-media-library, expo-av/video  |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏          | expo-notifications, expo-secure-store           |

## üîí –î–∞–Ω–Ω—ã–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

- –°–µ—Ä–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: TanStack Query (–æ–±—â–∏–π –∫–ª–∏–µ–Ω—Ç —Å retry=3, –±–µ–∑ refetch on focus).
- Auth util (`shared/lib/auth`): user_id, —Ç–æ–∫–µ–Ω—ã –∏ refresh –≤ SecureStore.
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`app.json`): –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è, iOS bundle `com.yzned.Fitchoice`, Android package `com.yzned.Fitchoice`, minSdk 24 / targetSdk 35, iOS deployment 15.1, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∫–∞–º–µ—Ä—É/–º–∏–∫—Ä–æ—Ñ–æ–Ω/–≥–∞–ª–µ—Ä–µ—é.

## üì∏ –§–æ—Ç–æ‚Äë–ø—Ä–æ–≥—Ä–µ—Å—Å

### –î–∞–Ω–Ω—ã–µ –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (`entities/progress`)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `getUserId()` (SecureStore). –ë–µ–∑ user_id –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Å—Ç–∞—Ä—Ç—É—é—Ç.
- –§–∞–π–ª—ã: `expo-file-system/legacy`, –ø—É—Ç—å `documentDirectory/progress/<userId>/<side>/<id>.<ext>`.
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: `index.json` –≤ –∫–æ—Ä–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è; –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –±–∏—Ç—ã–µ —Å—Å—ã–ª–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è; –∑–∞–ø–∏—Å–∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ.
- `saveProgressBatch` –≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–Ω–∏–º–∫–∏ –±–∞—Ç—á–∞ (append), —Å—Ç–∞–≤–∏—Ç –æ–±—â–∏–π `batchId`/`createdAt`, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—ë—Ç `MediaLibrary` asset, –æ–±–Ω–æ–≤–ª—è–µ—Ç meta –∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫—ç—à.
- –ú—É—Ç–∞—Ü–∏–∏/–∫–≤–µ—Ä–∏: `useProgressListQuery`, `useSaveProgressBatchMutation`, `useDeleteProgressPhotoMutation`, `useResetProgressMutation` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º `invalidateQueries`.
- `useProgressSeriesQuery` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∞—Ç—á–∏ –≤–∏–¥–∞ `{ dateId, batchId, photos (–¥–æ 4 –∫–∞–¥—Ä–æ–≤) }`.

### –ü—Ä–æ—Å–º–æ—Ç—Ä (`pages/photo-progress`)
- `PhotoProgressScreen`: –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö ‚Äî —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–ª–æ—É —Å—ä—ë–º–∫–∏; –∏–Ω–∞—á–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç `ExistingPhotosScreen`.
- `ExistingPhotosScreen`: —Å—á–∏—Ç–∞–µ—Ç 30-–¥–Ω–µ–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–µ—Ä–∏—è–º–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–Ω–∏ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–∫–Ω–∞ —Å—ä—ë–º–∫–∏, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –±–∞—Ç—á–∏ –ø–æ 4 —Ñ–æ—Ç–æ; –ø–µ—Ä–µ—Ö–æ–¥ –ø–µ—Ä–µ–¥–∞—ë—Ç `dateId` –∏ `batchId`.
- `PhotoSetShow`: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π –±–∞—Ç—á (4 —Ñ–æ—Ç–æ) –¥–ª—è –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö `dateId`/`batchId`.

### –°—ä—ë–º–∫–∞ (`features/progress-capture/ProgressCaptureFlow`)
–ü–æ—Ä—è–¥–æ–∫ —Ä–∞–∫—É—Ä—Å–æ–≤: `front ‚Üí back ‚Üí left ‚Üí right`. –û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è (`useOrientation`).
1. **CameraPermission** ‚Äî —Ñ–æ—Ç–æ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ; ¬´–î–∞–ª–µ–µ¬ª –∞–∫—Ç–∏–≤–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ –∫–∞–º–µ—Ä—ã; –∑–∞–∫—Ä—ã—Ç–∏–µ –≤–µ–¥—ë—Ç –Ω–∞ `/stats`.
2. **PhonePosition** ‚Äî –ø—Ä–µ–≤—å—é —Å —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä–æ–π, —Å–ª—É—à–∞–µ—Ç `expo-screen-orientation`; ¬´–î–∞–ª–µ–µ¬ª —Ç–æ–ª—å–∫–æ –≤ –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏.
3. **PositionReady** ‚Äî `PoseCamera` (MoveNet) —Å —Å–µ—Ç–∫–æ–π –∏ —Å–∏–ª—É—ç—Ç–æ–º; –ø–æ—Å–ª–µ –¥–µ—Ç–µ–∫—Ç–∞ 17 keypoints 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è ¬´–ù–∞—á–Ω—ë–º!¬ª –∏ –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å—ä—ë–º–∫–µ.
4. **CountdownCapture** ‚Äî 5‚Äë—Å–µ–∫—É–Ω–¥–Ω—ã–π –æ—Ç—Å—á—ë—Ç, —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ (`CameraView`), `StepProgress` –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ä–∞–∫—É—Ä—Å—É; —Å–Ω–∏–º–∞–µ—Ç –∫–∞–¥—Ä –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
5. **PreviewScreen** ‚Äî –ø—Ä–µ–≤—å—é –∫–∞–¥—Ä–∞, `StepProgress`, –∫–Ω–æ–ø–∫–∏ ¬´–ü–µ—Ä–µ—Å–Ω—è—Ç—å¬ª (–≤–æ–∑–≤—Ä–∞—Ç –∫ –ø–æ–∑–∏—Ü–∏–∏) –∏ ¬´–î–∞–ª–µ–µ¬ª (—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–Ω–∏–º–æ–∫ –∏ –∏–¥—ë—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ).
6. **FinalScreen** ‚Äî –º–∏–Ω–∏–∞—Ç—é—Ä—ã –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–Ω, –ø–µ—Ä–µ—Å—ä—ë–º–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞–∫—É—Ä—Å–∞: –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É (—Å—Ç–∞—Ä—Ç —Å —à–∞–≥–∞ `position`, –∑–∞—Ç–µ–º –æ—Ç—Å—á—ë—Ç/—Å—ä—ë–º–∫–∞/–ø—Ä–µ–≤—å—é, –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Ñ–∏–Ω–∞–ª, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è). –¢—É–º–±–ª–µ—Ä ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –≥–∞–ª–µ—Ä–µ—é¬ª (—á–µ—Ä–µ–∑ `MediaLibrary` –ø–æ –∑–∞–ø—Ä–æ—Å—É). ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª –∞–∫—Ç–∏–≤–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ 4 —Å–Ω–∏–º–∫–∞—Ö; `onSave` –≤—ã–∑—ã–≤–∞–µ—Ç `useSaveProgressBatchMutation` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –≤—ã–∑—ã–≤–∞—é—â–∏–π —ç–∫—Ä–∞–Ω.

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–º–µ–Ω—ã

- **training-session** ‚Äî FSM –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å poseflow-js –∏ PoseCamera.
- **survey-flow** ‚Äî –∞–Ω–∫–µ—Ç–∞/–≤–æ–ø—Ä–æ—Å—ã, –∫–æ–Ω—Ñ–∏–≥–∏ –≤ `entities/survey`.
- **chat** ‚Äî API + UI‚Äë–≤–∏–¥–∂–µ—Ç—ã, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞/–º–µ–¥–∏–∞.
- **diary** ‚Äî —Ç—Ä–µ–∫–∏–Ω–≥ –¥–Ω–µ–≤–Ω–∏–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π.
- **stats / stats-day** ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∏ –º–µ—Ç—Ä–∏–∫, –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —Ñ–æ—Ç–æ‚Äë–ø—Ä–æ–≥—Ä–µ—Å—Å—É.
- **auth/user** ‚Äî API‚Äë–æ–±—ë—Ä—Ç–∫–∏, —Ö—Ä–∞–Ω–µ–Ω–∏–µ user_id/—Ç–æ–∫–µ–Ω–æ–≤ –≤ SecureStore.

## üé® –°—Ç–∏–ª–∏

- **NativeWind** —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π –ø–∞–ª–∏—Ç—Ä–æ–π (`brand-green`, `brand-purple`, `light-text`, `bg-dark`).
- UI kit –≤ `shared/ui` (–∫–Ω–æ–ø–∫–∏, –ª–µ–π–∞—É—Ç—ã, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã, —Ç–æ—Å—Ç—ã, StepProgress, BackgroundLayout –∏ –¥—Ä.).
- –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã/—Ñ–æ–Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –∏ —Ñ–æ—Ç–æ‚Äë—Ñ–ª–æ—É; —à—Ä–∏—Ñ—Ç—ã Rimma Sans –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `FontLoader`.

## üîß –°–∫—Ä–∏–ø—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã

- `pnpm run lint` ‚Äî `eslint src --ext .ts,.tsx --max-warnings 10`
- `pnpm run format` / `format:check` ‚Äî prettier (—Å tailwind plugin)
- `pnpm run type-check` ‚Äî `tsc --noEmit`
- EAS: `pnpm run deploy`, `pnpm run update:preview`, `pnpm run update:production`, `pnpm run build:preview:*` (—Å–º. `package.json`).

## üöÄ –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è

- –ü–æ—Ä—Ç—Ä–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (Expo `orientation: "portrait"`).
- iOS: deployment target 15.1, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ iPad; —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –∫–∞–º–µ—Ä—É/–º–∏–∫—Ä–æ—Ñ–æ–Ω/–≥–∞–ª–µ—Ä–µ—é –æ–ø–∏—Å–∞–Ω—ã –≤ `app.json`.
- Android: minSdk 24, targetSdk 35, edge-to-edge, Proguard/shrink –≤–∫–ª—é—á–µ–Ω—ã –≤ release.

## –ü–æ–ª–µ–∑–Ω—ã–µ –ø—É—Ç–∏

- `src/entities/progress/lib/storage.ts` ‚Äî –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ —Ñ–æ—Ç–æ‚Äë–ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
- `src/features/progress-capture/ui/*` ‚Äî —à–∞–≥–∏ —Ñ–ª–æ—É —Å—ä—ë–º–∫–∏.
- `src/widgets/pose-camera` ‚Äî PoseCamera –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ MoveNet.
- `src/app/_providers` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏ QueryClient.
